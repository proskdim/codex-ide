<div class="modal modal-open backdrop-blur-sm animate-in fade-in duration-300">
  <div
    class="modal-box relative flex h-full w-full max-w-[1500px] flex-col overflow-hidden border border-base-300 bg-base-200 p-0 shadow-2xl animate-in zoom-in-95 duration-300 md:h-[95vh] md:w-[98vw] md:rounded-xl"
  >
    <!-- Header Navbar -->
    <nav
      class="navbar z-20 min-h-14 shrink-0 select-none border-b border-base-300 bg-base-100 px-4"
    >
      <div class="navbar-start">
        <button
          (click)="executeCloseEditor()"
          aria-label="Close editor"
          class="btn btn-ghost btn-sm text-base-content/50 hover:bg-error hover:text-error-content"
        >
          <span class="text-lg">✕</span>
        </button>
      </div>

      <div class="navbar-center">
        <span class="text-sm font-bold tracking-widest opacity-50 uppercase">Codex Editor</span>
      </div>

      <div class="navbar-end">
        <button
          (click)="executeSubmitCode()"
          class="btn btn-success btn-sm px-6 font-bold shadow-sm"
        >
          Submit
        </button>
      </div>
    </nav>

    <!-- Main Content Area -->
    <main class="relative z-10 flex-1 overflow-hidden p-2">
      <as-split
        direction="horizontal"
        (dragEnd)="handleSplitDragEnd()"
        [gutterSize]="8"
        [disabled]="isDescriptionCollapsed()"
      >
        <!-- Description Section -->
        <as-split-area [size]="mainSplitSizes[0]" [minSize]="4">
          <section
            class="card card-compact h-full overflow-hidden rounded-xl border border-base-300 bg-base-100"
          >
            <div
              class="flex shrink-0 items-center border-b border-base-300 bg-base-200/50 text-sm font-bold"
              [class.justify-between]="!isDescriptionCollapsed()"
              [class.justify-center]="isDescriptionCollapsed()"
            >
              @if (!isDescriptionCollapsed()) {
              <span class="flex items-center gap-2 px-5 py-2 tracking-wide opacity-70">
                Description
              </span>
              }
              <button
                (click)="toggleDescription()"
                class="btn btn-ghost btn-xs text-base-content/50"
                [class.mt-2]="isDescriptionCollapsed()"
                [title]="isDescriptionCollapsed() ? 'Expand' : 'Collapse'"
              >
                <span class="text-lg">{{ isDescriptionCollapsed() ? '→' : '←' }}</span>
              </button>
            </div>

            @if (!isDescriptionCollapsed()) {
            <div class="card-body custom-scrollbar overflow-y-auto p-6 leading-relaxed">
              <markdown [data]="description()" class="prose prose-sm max-w-none"></markdown>
            </div>
            } @else {
            <div class="flex flex-1 items-center justify-center bg-base-200/30">
              <!-- Vertical text or just empty space -->
            </div>
            }
          </section>
        </as-split-area>

        <!-- Editor and Terminal Section -->
        <as-split-area [size]="mainSplitSizes[1]">
          <as-split
            direction="vertical"
            (dragEnd)="handleSplitDragEnd()"
            [gutterSize]="8"
            [disabled]="isEditorCollapsed() || isTerminalCollapsed()"
          >
            <!-- Editor Section -->
            <as-split-area [size]="rightSplitSizes[0]" [minSize]="6">
              <section
                class="card card-compact h-full overflow-hidden rounded-xl border border-base-300 bg-base-100"
              >
                <div
                  class="flex shrink-0 items-center border-b border-base-300 bg-base-200/50 text-sm font-bold"
                  [class.justify-between]="!isEditorCollapsed()"
                  [class.justify-center]="isEditorCollapsed()"
                >
                  @if (!isEditorCollapsed()) {
                  <span class="flex items-center gap-2 px-5 py-2 tracking-wide opacity-70">
                    solution.ts
                  </span>
                  }
                  <button
                    (click)="toggleEditor()"
                    class="btn btn-ghost btn-xs text-base-content/50"
                    [title]="isEditorCollapsed() ? 'Expand' : 'Collapse'"
                  >
                    <span class="text-lg">{{ isEditorCollapsed() ? '↓' : '↑' }}</span>
                  </button>
                </div>
                <div class="min-h-0 flex-1" [class.hidden]="isEditorCollapsed()">
                  <ngx-monaco-editor
                    [options]="editorOptions"
                    [ngModel]="code()"
                    (ngModelChange)="code.set($event)"
                    (onInit)="handleEditorInit($event)"
                    style="height: 100%"
                  ></ngx-monaco-editor>
                </div>
              </section>
            </as-split-area>

            <!-- Terminal / Test cases Section -->
            <as-split-area [size]="rightSplitSizes[1]" [minSize]="6">
              <section
                class="card card-compact h-full overflow-hidden rounded-xl border border-base-300 bg-base-100"
              >
                <div
                  class="flex shrink-0 items-center border-b border-base-300 bg-base-200/50 text-sm font-bold"
                  [class.justify-between]="!isTerminalCollapsed()"
                  [class.justify-center]="isTerminalCollapsed()"
                >
                  @if (!isTerminalCollapsed()) {
                  <div role="tablist" class="tabs tabs-bordered tabs-sm px-2">
                    <input
                      type="radio"
                      name="terminal_tabs"
                      role="tab"
                      class="tab"
                      aria-label="Test cases"
                      checked="checked"
                    />
                    <input
                      type="radio"
                      name="terminal_tabs"
                      role="tab"
                      class="tab"
                      aria-label="Result"
                    />
                  </div>
                  }
                  <button
                    (click)="toggleTerminal()"
                    class="btn btn-ghost btn-xs text-base-content/50"
                    [title]="isTerminalCollapsed() ? 'Expand' : 'Collapse'"
                  >
                    <span class="text-lg">{{ isTerminalCollapsed() ? '↑' : '↓' }}</span>
                  </button>
                </div>
                @if (!isTerminalCollapsed()) {
                <div class="card-body p-4">
                  <div class="mockup-code bg-base-300 text-base-content shadow-inner">
                    <pre data-prefix=">"><code>Running tests...</code></pre>
                    <pre data-prefix=" " class="text-success"><code>Done!</code></pre>
                  </div>
                </div>
                }
              </section>
            </as-split-area>
          </as-split>
        </as-split-area>
      </as-split>
    </main>
  </div>
</div>
