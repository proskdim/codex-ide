<div class="modal modal-open backdrop-blur-sm animate-fade-in">
  <div
    class="modal-box w-full h-full md:w-[98vw] md:h-[95vh] max-w-[1500px] p-0 flex flex-col bg-base-200 rounded-xl shadow-2xl overflow-hidden border border-base-300 relative animate-scale-up"
  >
    <nav
      class="navbar bg-base-100 border-b border-base-300 px-4 min-h-14 shrink-0 z-20 select-none"
    >
      <div class="flex-1">
        <button
          (click)="executeCloseEditor()"
          aria-label="Close editor"
          class="btn btn-ghost btn-sm text-base-content/50 hover:bg-error hover:text-error-content"
        >
          <span class="text-lg">✕</span>
        </button>
      </div>

      <div class="flex-none">
        <button
          (click)="executeSubmitCode()"
          class="btn btn-success btn-sm px-6 font-bold shadow-sm"
        >
          Submit
        </button>
      </div>
    </nav>

    <main class="flex-1 overflow-hidden relative z-10 p-2">
      <as-split
        direction="horizontal"
        (dragEnd)="handleSplitDragEnd()"
        [gutterSize]="8"
        [disabled]="isDescriptionCollapsed()"
      >
        <!-- Description Section -->
        <as-split-area [size]="mainSplitSizes[0]" [minSize]="4">
          <section
            class="card card-compact bg-base-100 border border-base-300 h-full rounded-xl overflow-hidden"
          >
            <div
              class="flex bg-base-200/50 border-b border-base-300 text-sm font-bold shrink-0 items-center pr-2"
              [class.justify-between]="!isDescriptionCollapsed()"
              [class.justify-center]="isDescriptionCollapsed()"
            >
              @if (!isDescriptionCollapsed()) {
              <span class="px-5 py-2 opacity-70 flex items-center gap-2 tracking-wide">
                Description
              </span>
              }
              <button
                (click)="toggleDescription()"
                class="btn btn-ghost btn-xs text-base-content/50"
                [class.mt-2]="isDescriptionCollapsed()"
                [title]="isDescriptionCollapsed() ? 'Expand' : 'Collapse'"
              >
                <span class="text-lg">{{ isDescriptionCollapsed() ? '→' : '←' }}</span>
              </button>
            </div>
            @if (!isDescriptionCollapsed()) {
            <div class="card-body p-6 overflow-y-auto custom-scrollbar leading-relaxed">
              <markdown [data]="description()" class="prose prose-sm max-w-none"></markdown>
            </div>
            } @else {
            <div class="flex-1 flex items-center justify-center bg-base-200/30">
              <!-- Vertical text or just empty space -->
            </div>
            }
          </section>
        </as-split-area>

        <!-- Editor and Terminal Section -->
        <as-split-area [size]="mainSplitSizes[1]">
          <as-split
            direction="vertical"
            (dragEnd)="handleSplitDragEnd()"
            [gutterSize]="8"
            [disabled]="isEditorCollapsed() || isTerminalCollapsed()"
          >
            <!-- Editor Section -->
            <as-split-area [size]="rightSplitSizes[0]" [minSize]="6">
              <section
                class="card card-compact bg-base-100 border border-base-300 h-full rounded-xl overflow-hidden"
              >
                <div
                  class="flex bg-base-200/50 border-b border-base-300 text-sm font-bold shrink-0 items-center pr-2"
                  [class.justify-between]="!isEditorCollapsed()"
                  [class.justify-center]="isEditorCollapsed()"
                >
                  @if (!isEditorCollapsed()) {
                  <span class="px-5 py-2 opacity-70 flex items-center gap-2 tracking-wide">
                    solution.ts
                  </span>
                  }
                  <button
                    (click)="toggleEditor()"
                    class="btn btn-ghost btn-xs text-base-content/50"
                    [title]="isEditorCollapsed() ? 'Expand' : 'Collapse'"
                  >
                    <span class="text-lg">{{ isEditorCollapsed() ? '↓' : '↑' }}</span>
                  </button>
                </div>
                <div class="flex-1 min-h-0" [class.hidden]="isEditorCollapsed()">
                  <ngx-monaco-editor
                    [options]="editorOptions"
                    [ngModel]="code()"
                    (ngModelChange)="code.set($event)"
                    (onInit)="handleEditorInit($event)"
                    style="height: 100%"
                  ></ngx-monaco-editor>
                </div>
              </section>
            </as-split-area>

            <!-- Terminal / Test cases Section -->
            <as-split-area [size]="rightSplitSizes[1]" [minSize]="6">
              <section
                class="card card-compact bg-base-100 border border-base-300 h-full rounded-xl overflow-hidden"
              >
                <div
                  class="flex bg-base-200/50 border-b border-base-300 text-sm font-bold shrink-0 items-center pr-2"
                  [class.justify-between]="!isTerminalCollapsed()"
                  [class.justify-center]="isTerminalCollapsed()"
                >
                  @if (!isTerminalCollapsed()) {
                  <span class="px-5 py-2 opacity-70 flex items-center gap-2 tracking-wide">
                    Test cases
                  </span>
                  }
                  <button
                    (click)="toggleTerminal()"
                    class="btn btn-ghost btn-xs text-base-content/50"
                    [title]="isTerminalCollapsed() ? 'Expand' : 'Collapse'"
                  >
                    <span class="text-lg">{{ isTerminalCollapsed() ? '↑' : '↓' }}</span>
                  </button>
                </div>
                @if (!isTerminalCollapsed()) {
                <div class="card-body p-4 opacity-80">test cases content</div>
                }
              </section>
            </as-split-area>
          </as-split>
        </as-split-area>
      </as-split>
    </main>
  </div>
</div>
